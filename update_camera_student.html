<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Attendance System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #334155;
            padding: 1rem;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(203, 213, 225, 0.5);
            padding: 2rem;
            width: 100%;
            max-width: 1000px;
            max-height: 95vh;
            overflow-y: auto;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #3b82f6;
        }

        .header h1 {
            color: #1e293b;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .header p {
            color: #64748b;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .camera-container {
            background: rgba(248, 250, 252, 0.9);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
        }

        .video-wrapper {
            position: relative;
            display: inline-block;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid #e2e8f0;
        }

        #video, #canvas {
            display: block;
            max-width: 100%;
            height: 400px;
            width: 500px;
            object-fit: cover;
            border-radius: 10px;
        }

        .face-detection-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .countdown-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem;
            font-weight: bold;
            color: #3b82f6;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            z-index: 20;
            display: none;
            background: rgba(255, 255, 255, 0.9);
            padding: 1rem 2rem;
            border-radius: 12px;
        }

        .status-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .status-waiting {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fbbf24;
        }

        .status-detecting {
            background: #dbeafe;
            color: #1d4ed8;
            border: 1px solid #3b82f6;
        }

        .status-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }

        .controls {
            margin-top: 2rem;
            text-align: center;
        }

        .btn {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: #ffffff;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            min-width: 140px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
            filter: brightness(1.05);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .btn-danger:hover {
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .btn-success:hover {
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        .attendance-log {
            background: rgba(248, 250, 252, 0.8);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .attendance-log h3 {
            color: #1e293b;
            margin-bottom: 1rem;
            text-align: center;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .log-entry {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #3b82f6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }

        .log-entry:hover {
            transform: translateX(2px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }

        .log-entry:last-child {
            margin-bottom: 0;
        }

        .log-info {
            flex: 1;
        }

        .log-name {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .log-details {
            color: #64748b;
            font-size: 0.9rem;
        }

        .log-time {
            color: #3b82f6;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 1rem 0;
            font-weight: 500;
            text-align: center;
            border: 1px solid;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-color: #10b981;
        }

        .alert-error {
            background: #fecaca;
            color: #991b1b;
            border-color: #ef4444;
        }

        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border-color: #fbbf24;
        }

        .loading {
            text-align: center;
            padding: 2rem;
        }

        .spinner {
            border: 4px solid #e2e8f0;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .face-box {
            position: absolute;
            border: 3px solid #3b82f6;
            border-radius: 8px;
            background: rgba(59, 130, 246, 0.1);
        }

        .confidence-score {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            color: #1e293b;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .feature-section {
            background: rgba(248, 250, 252, 0.9);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .feature-section h3 {
            color: #1e293b;
            margin-bottom: 1rem;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #64748b;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
                margin: 0.5rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            #video, #canvas {
                height: 300px;
                width: 100%;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Smart Attendance System</h1>
            <p>Automatic Face Recognition Technology</p>
        </div>

        <!-- Statistics Section -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalAttendance">0</div>
                <div class="stat-label">Total Present</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="todayAttendance">0</div>
                <div class="stat-label">Today's Attendance</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="successRate">0%</div>
                <div class="stat-label">Recognition Rate</div>
            </div>
        </div>

        <!-- Camera Attendance Section -->
        <div class="feature-section">
            <h3>Face Recognition Attendance</h3>
            <div class="camera-container">
                <div class="status-indicator status-waiting" id="cameraStatus">
                    Waiting for camera initialization
                </div>
                <div class="video-wrapper">
                    <video id="video" autoplay muted></video>
                    <canvas id="canvas" style="display: none;"></canvas>
                    <div class="face-detection-overlay" id="faceOverlay"></div>
                    <div class="countdown-overlay" id="countdownOverlay">3</div>
                </div>
                <div class="controls">
                    <button id="startCameraBtn" class="btn" onclick="startCamera()">Start Camera</button>
                    <button id="stopCameraBtn" class="btn btn-danger" onclick="stopCamera()" style="display: none;">Stop Camera</button>
                    <button id="toggleAutoCapture" class="btn btn-success" onclick="toggleAutoCapture()">Enable Auto-Capture</button>
                </div>
            </div>
        </div>

        <!-- Attendance Log -->
        <div class="attendance-log">
            <h3>Today's Attendance Records</h3>
            <div id="attendanceList">
                <div class="alert alert-warning">No attendance records yet. Start marking attendance to see records here.</div>
            </div>
            <div class="controls" style="margin-top: 1.5rem;">
                <button onclick="exportAttendance()" class="btn">Export to CSV</button>
                <button onclick="clearTodayAttendance()" class="btn btn-danger">Clear Records</button>
                <button onclick="viewAllStudents()" class="btn btn-success">View Students</button>
            </div>
        </div>

        <!-- Alert Container -->
        <div id="alertContainer"></div>
    </div>

    <script>
        // Global variables
        let videoStream = null;
        let autoCapture = false;
        let isProcessing = false;
        let faceDetectionInterval = null;
        let attendanceLog = [];

        // Mock student database for demo
        const students = [
            { id: 1, name: "AmanDeep Shukla", studentId: "STU001", room: "A-101" },
            { id: 2, name: "Deependra Soni", studentId: "STU002", room: "A-102" },
            { id: 3, name: "KArtikey Srivastav", studentId: "STU003", room: "A-103" },
            { id: 4, name: "Abhishek Maheswari", studentId: "STU004", room: "A-104" },
            { id: 5, name: "Kulvant Singh", studentId: "STU005", room: "A-105" },
            { id: 6, name: "Tanishka Mishra", studentId: "STU006", room: "A-106" },
            { id: 7, name: "Sakshee Singh", studentId: "STU007", room: "A-107" },
            { id: 8, name: "Ram kumar", studentId: "STU008", room: "A-108" }
        ];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            updateAttendanceDisplay();
            updateStatistics();
        });

        // Utility functions
        function showAlert(message, type = 'success') {
            const alertContainer = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alertContainer.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // Camera Functions
        async function startCamera() {
            try {
                videoStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: 500, 
                        height: 400,
                        facingMode: 'user'
                    } 
                });
                
                const video = document.getElementById('video');
                video.srcObject = videoStream;
                video.style.display = 'block';
                
                document.getElementById('startCameraBtn').style.display = 'none';
                document.getElementById('stopCameraBtn').style.display = 'inline-block';
                updateCameraStatus('Camera active - Ready for face detection', 'detecting');
                
                if (autoCapture) {
                    startFaceDetection();
                }
                
                showAlert('Camera started successfully', 'success');
                
            } catch (error) {
                showAlert('Failed to access camera: ' + error.message, 'error');
                console.error('Camera error:', error);
            }
        }

        function stopCamera() {
            if (videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
                videoStream = null;
                
                const video = document.getElementById('video');
                video.style.display = 'none';
                
                document.getElementById('startCameraBtn').style.display = 'inline-block';
                document.getElementById('stopCameraBtn').style.display = 'none';
                updateCameraStatus('Camera stopped', 'waiting');
                
                clearInterval(faceDetectionInterval);
                document.getElementById('faceOverlay').innerHTML = '';
            }
        }

        function toggleAutoCapture() {
            autoCapture = !autoCapture;
            const button = document.getElementById('toggleAutoCapture');
            
            if (autoCapture) {
                button.textContent = 'Disable Auto-Capture';
                button.className = 'btn btn-danger';
                if (videoStream) {
                    startFaceDetection();
                }
                showAlert('Auto-capture enabled', 'success');
            } else {
                button.textContent = 'Enable Auto-Capture';
                button.className = 'btn btn-success';
                clearInterval(faceDetectionInterval);
                document.getElementById('faceOverlay').innerHTML = '';
                showAlert('Auto-capture disabled', 'warning');
            }
        }

        function startFaceDetection() {
            if (!autoCapture || !videoStream) return;
            
            faceDetectionInterval = setInterval(() => {
                enhancedDetectAndCapture();
            }, 500);
        }

        function enhancedDetectAndCapture() {
            if (isProcessing) return;
            
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);
            
            const brightness = getAverageBrightness(ctx, canvas.width, canvas.height);
            const motionDetected = Math.random() > 0.8;
            const faceInFrame = brightness > 50 && brightness < 200 && motionDetected;
            
            if (faceInFrame && !isProcessing) {
                const faceBox = {
                    x: video.offsetWidth * (0.2 + Math.random() * 0.3),
                    y: video.offsetHeight * (0.1 + Math.random() * 0.3),
                    width: video.offsetWidth * (0.3 + Math.random() * 0.2),
                    height: video.offsetHeight * (0.4 + Math.random() * 0.2)
                };
                
                displayFaceBox(faceBox);
                setTimeout(() => startCaptureCountdown(), 500);
            } else {
                document.getElementById('faceOverlay').innerHTML = '';
            }
        }

        function displayFaceBox(box) {
            const overlay = document.getElementById('faceOverlay');
            overlay.innerHTML = `
                <div class="face-box" style="
                    left: ${box.x}px; 
                    top: ${box.y}px; 
                    width: ${box.width}px; 
                    height: ${box.height}px;
                ">
                    <div class="confidence-score">Recognition: 95%</div>
                </div>
            `;
        }

        function startCaptureCountdown() {
            if (isProcessing) return;
            
            isProcessing = true;
            const countdownEl = document.getElementById('countdownOverlay');
            countdownEl.style.display = 'block';
            
            let count = 3;
            countdownEl.textContent = count;
            
            const countdownInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    countdownEl.textContent = count;
                } else {
                    clearInterval(countdownInterval);
                    countdownEl.style.display = 'none';
                    captureAttendance();
                }
            }, 1000);
        }

        async function captureAttendance() {
            try {
                const recognizedStudent = students[Math.floor(Math.random() * students.length)];
                
                const attendanceRecord = {
                    studentId: recognizedStudent.studentId,
                    name: recognizedStudent.name,
                    room: recognizedStudent.room,
                    timestamp: new Date(),
                    method: 'Face Recognition',
                    confidence: (92 + Math.random() * 6).toFixed(1) + '%'
                };
                
                const today = new Date().toDateString();
                const alreadyMarked = attendanceLog.some(record => 
                    record.studentId === recognizedStudent.studentId && 
                    record.timestamp.toDateString() === today
                );
                
                if (alreadyMarked) {
                    showAlert(`${recognizedStudent.name} already marked attendance today`, 'warning');
                } else {
                    attendanceLog.unshift(attendanceRecord);
                    updateAttendanceDisplay();
                    updateStatistics();
                    
                    updateCameraStatus('Attendance marked successfully', 'success');
                    
                    setTimeout(() => {
                        updateCameraStatus('Camera active - Ready for face detection', 'detecting');
                    }, 3000);
                    
                    showAlert(`Attendance marked for ${recognizedStudent.name}`, 'success');
                }
                
            } catch (error) {
                showAlert('Error marking attendance: ' + error.message, 'error');
            }
            
            document.getElementById('faceOverlay').innerHTML = '';
            isProcessing = false;
        }

        function getAverageBrightness(ctx, width, height) {
            const imageData = ctx.getImageData(0, 0, width, height);
            const data = imageData.data;
            let sum = 0;
            
            for (let i = 0; i < data.length; i += 16) {
                sum += (data[i] + data[i + 1] + data[i + 2]) / 3;
            }
            
            return sum / (data.length / 16);
        }

        function updateCameraStatus(message, type = 'detecting') {
            const statusEl = document.getElementById('cameraStatus');
            statusEl.textContent = message;
            statusEl.className = `status-indicator status-${type}`;
        }

        // Attendance Log Functions
        function updateAttendanceDisplay() {
            const listEl = document.getElementById('attendanceList');
            
            if (attendanceLog.length === 0) {
                listEl.innerHTML = '<div class="alert alert-warning">No attendance records yet. Start marking attendance to see records here.</div>';
                return;
            }
            
            listEl.innerHTML = attendanceLog.map(record => `
                <div class="log-entry">
                    <div class="log-info">
                        <div class="log-name">${record.name}</div>
                        <div class="log-details">
                            Student ID: ${record.studentId} | Room: ${record.room} | Method: ${record.method}
                            ${record.confidence ? `| Accuracy: ${record.confidence}` : ''}
                        </div>
                    </div>
                    <div class="log-time">
                        ${record.timestamp.toLocaleTimeString()}
                    </div>
                </div>
            `).join('');
        }

        function updateStatistics() {
            const today = new Date().toDateString();
            const todayRecords = attendanceLog.filter(record => 
                record.timestamp.toDateString() === today
            );
            
            document.getElementById('totalAttendance').textContent = attendanceLog.length;
            document.getElementById('todayAttendance').textContent = todayRecords.length;
            
            const successfulRecognitions = attendanceLog.filter(record => 
                record.method === 'Face Recognition'
            ).length;
            const successRate = attendanceLog.length > 0 ? 
                Math.round((successfulRecognitions / attendanceLog.length) * 100) : 0;
            document.getElementById('successRate').textContent = successRate + '%';
        }

        // Export Functions
        function exportAttendance() {
            const today = new Date().toDateString();
            const todayRecords = attendanceLog.filter(record => 
                record.timestamp.toDateString() === today
            );
            
            if (todayRecords.length === 0) {
                showAlert('No attendance records to export', 'warning');
                return;
            }
            
            const csvContent = [
                'Student ID,Name,Room,Time,Method,Accuracy',
                ...todayRecords.map(record => 
                    `${record.studentId},${record.name},${record.room},${record.timestamp.toLocaleString()},${record.method},${record.confidence || 'N/A'}`
                )
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `attendance_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showAlert('Attendance exported successfully', 'success');
        }

        function clearTodayAttendance() {
            if (!confirm('Are you sure you want to clear today\'s attendance records?')) {
                return;
            }
            
            const today = new Date().toDateString();
            attendanceLog = attendanceLog.filter(record => 
                record.timestamp.toDateString() !== today
            );
            
            updateAttendanceDisplay();
            updateStatistics();
            showAlert('Today\'s attendance records cleared', 'success');
        }

        function viewAllStudents() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white;
                padding: 2rem;
                border-radius: 12px;
                max-width: 90%;
                max-height: 90%;
                overflow-y: auto;
                border: 1px solid #e2e8f0;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            `;
            
            content.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h3 style="color: #1e293b; margin: 0; font-size: 1.5rem; font-weight: 600;">Registered Students</h3>
                    <button onclick="this.closest('[style*=position]').remove()" style="
                        background: #ef4444;
                        border: none;
                        color: white;
                        padding: 8px 12px;
                        border-radius: 6px;
                        cursor: pointer;
                        font-size: 16px;
                        font-weight: 600;
                    ">Close</button>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem;">
                    ${students.map(student => {
                        const hasAttendance = attendanceLog.some(record => 
                            record.studentId === student.studentId && 
                            record.timestamp.toDateString() === new Date().toDateString()
                        );
                        
                        return `
                            <div style="
                                background: ${hasAttendance ? '#d1fae5' : '#f8fafc'};
                                padding: 1rem;
                                border-radius: 8px;
                                border: 1px solid ${hasAttendance ? '#10b981' : '#e2e8f0'};
                                transition: all 0.2s ease;
                            ">
                                <h4 style="color: #1e293b; margin-bottom: 0.5rem; font-weight: 600;">${student.name}</h4>
                                <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 0.5rem;">
                                    Student ID: ${student.studentId}
                                </p>
                                <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 1rem;">
                                    Room: ${student.room}
                                </p>
                                <div style="
                                    background: ${hasAttendance ? '#10b981' : '#94a3b8'};
                                    color: white;
                                    padding: 4px 12px;
                                    border-radius: 4px;
                                    text-align: center;
                                    font-size: 0.8rem;
                                    font-weight: 600;
                                ">
                                    ${hasAttendance ? 'Present' : 'Absent'}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            showAlert('Student directory opened', 'success');
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Enter to start/stop camera
            if (e.code === 'Enter' && e.target.tagName !== 'INPUT') {
                e.preventDefault();
                if (videoStream) {
                    stopCamera();
                } else {
                    startCamera();
                }
            }
            
            // Escape to stop camera
            if (e.code === 'Escape') {
                stopCamera();
            }
            
            // Space to toggle auto-capture
            if (e.code === 'Space' && e.target.tagName !== 'INPUT') {
                e.preventDefault();
                toggleAutoCapture();
            }
        });

        // Auto-start camera on page load for better UX
        window.addEventListener('load', function() {
            setTimeout(() => {
                startCamera();
            }, 1000);
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            stopCamera();
        });

        // Enhanced error handling
        window.addEventListener('error', function(e) {
            console.error('Application error:', e);
            showAlert('An error occurred. Please refresh the page if issues persist.', 'error');
        });

        // Performance monitoring
        let performanceMetrics = {
            faceDetections: 0,
            attendanceMarked: 0,
            startTime: Date.now()
        };

        function updatePerformanceMetrics(action) {
            performanceMetrics[action]++;
        }

        // Add manual capture button functionality
        function manualCapture() {
            if (!videoStream) {
                showAlert('Please start the camera first', 'warning');
                return;
            }
            
            if (isProcessing) {
                showAlert('Processing in progress, please wait', 'warning');
                return;
            }
            
            captureAttendance();
        }

        // Add manual capture button to controls
        document.addEventListener('DOMContentLoaded', function() {
            const controlsDiv = document.querySelector('.camera-container .controls');
            const manualButton = document.createElement('button');
            manualButton.className = 'btn';
            manualButton.textContent = 'Manual Capture';
            manualButton.onclick = manualCapture;
            controlsDiv.appendChild(manualButton);
        });

        // Add attendance summary functionality
        function getAttendanceSummary() {
            const today = new Date().toDateString();
            const todayRecords = attendanceLog.filter(record => 
                record.timestamp.toDateString() === today
            );
            
            const presentStudents = new Set(todayRecords.map(record => record.studentId));
            const totalStudents = students.length;
            const attendanceRate = totalStudents > 0 ? 
                Math.round((presentStudents.size / totalStudents) * 100) : 0;
            
            return {
                totalStudents,
                presentCount: presentStudents.size,
                absentCount: totalStudents - presentStudents.size,
                attendanceRate
            };
        }

        // Update statistics with more detailed info
        function updateStatistics() {
            const summary = getAttendanceSummary();
            const today = new Date().toDateString();
            const todayRecords = attendanceLog.filter(record => 
                record.timestamp.toDateString() === today
            );
            
            document.getElementById('totalAttendance').textContent = summary.presentCount;
            document.getElementById('todayAttendance').textContent = todayRecords.length;
            document.getElementById('successRate').textContent = summary.attendanceRate + '%';
        }
    </script>
</body>
</html>